<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerenciamento de Energia - PhotoViewer Lite</title>
  <style>
    /* ESTILOS GERAIS DA JANELA DE ENERGIA */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      min-height: 100vh;
      box-sizing: border-box;
    }

    /* CABE√áALHO DA JANELA */
    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      margin: 0;
      font-size: 28px;
      font-weight: 300;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    /* SE√á√ÉO DE MONITORAMENTO DE RECURSOS */
    .monitoring-section {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .section-title {
      font-size: 20px;
      margin-bottom: 20px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* GRID DE RECURSOS */
    .resource-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .resource-card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .resource-label {
      font-size: 14px;
      opacity: 0.8;
      margin-bottom: 5px;
    }

    .resource-value {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .resource-bar {
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      overflow: hidden;
    }

    .resource-fill {
      height: 100%;
      background: linear-gradient(90deg, #4CAF50, #FFC107, #F44336);
      border-radius: 4px;
      transition: width 0.3s ease;
    }

    /* SE√á√ÉO DE CONTROLES DE ENERGIA */
    .power-controls {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 25px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .control-group {
      margin-bottom: 20px;
    }

    .control-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      margin-bottom: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .control-info {
      flex: 1;
    }

    .control-title {
      font-weight: 500;
      margin-bottom: 5px;
    }

    .control-description {
      font-size: 12px;
      opacity: 0.7;
    }

    /* BOT√ïES E SWITCHES */
    .toggle-switch {
      position: relative;
      width: 60px;
      height: 30px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .toggle-switch.active {
      background: #4CAF50;
    }

    .toggle-slider {
      position: absolute;
      top: 3px;
      left: 3px;
      width: 24px;
      height: 24px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s ease;
    }

    .toggle-switch.active .toggle-slider {
      transform: translateX(30px);
    }

    .action-button {
      background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
      border: none;
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      margin: 5px;
    }

    .action-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .action-button:active {
      transform: translateY(0);
    }

    /* STATUS INDICATORS */
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .status-active {
      background: #4CAF50;
      box-shadow: 0 0 10px #4CAF50;
    }

    .status-inactive {
      background: #757575;
    }

    /* INFORMA√á√ïES ADICIONAIS */
    .info-panel {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      border-left: 4px solid #4CAF50;
    }

    .info-panel h4 {
      margin: 0 0 10px 0;
      color: #4CAF50;
    }

    .info-panel p {
      margin: 5px 0;
      font-size: 13px;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <!-- CABE√áALHO DA JANELA -->
  <div class="header">
    <h1>‚ö° Gerenciamento de Energia</h1>
  </div>

  <!-- SE√á√ÉO DE MONITORAMENTO DE RECURSOS -->
  <div class="monitoring-section">
    <div class="section-title">
      üìä Monitoramento de Recursos
    </div>
    
    <div class="resource-grid">
      <div class="resource-card">
        <div class="resource-label">CPU</div>
        <div class="resource-value" id="cpuValue">0%</div>
        <div class="resource-bar">
          <div class="resource-fill" id="cpuBar" style="width: 0%"></div>
        </div>
      </div>
      
      <div class="resource-card">
        <div class="resource-label">Mem√≥ria</div>
        <div class="resource-value" id="memoryValue">0%</div>
        <div class="resource-bar">
          <div class="resource-fill" id="memoryBar" style="width: 0%"></div>
        </div>
      </div>
      
      <div class="resource-card">
        <div class="resource-label">Temperatura</div>
        <div class="resource-value" id="tempValue">--¬∞C</div>
        <div class="resource-bar">
          <div class="resource-fill" id="tempBar" style="width: 0%"></div>
        </div>
      </div>
      
      <div class="resource-card">
        <div class="resource-label">Energia</div>
        <div class="resource-value" id="powerValue">--W</div>
        <div class="resource-bar">
          <div class="resource-fill" id="powerBar" style="width: 0%"></div>
        </div>
      </div>
      
      <div class="resource-card">
        <div class="resource-label">Bateria</div>
        <div class="resource-value" id="batteryValue">--% üîå</div>
        <div class="resource-bar">
          <div class="resource-fill" id="batteryBar" style="width: 0%"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- SE√á√ÉO DE CONTROLES DE ENERGIA -->
  <div class="power-controls">
    <div class="section-title">
      üîß Controles de Energia
    </div>
    
    <div class="control-group">
      <div class="control-item">
        <div class="control-info">
          <div class="control-title">
            <span class="status-indicator status-inactive" id="powerSaveStatus"></span>
            Manter Sistema Acordado
          </div>
          <div class="control-description">
            Impede que o sistema entre em modo de suspens√£o
          </div>
        </div>
        <div class="toggle-switch" id="powerSaveToggle">
          <div class="toggle-slider"></div>
        </div>
      </div>
      
      <div class="control-item">
        <div class="control-info">
          <div class="control-title">
            <span class="status-indicator status-inactive" id="lowPowerStatus"></span>
            Modo Economia de Energia
          </div>
          <div class="control-description">
            Reduz o uso de recursos para economizar energia
          </div>
        </div>
        <div class="toggle-switch" id="lowPowerToggle">
          <div class="toggle-slider"></div>
        </div>
      </div>
    </div>
    
    <div class="control-group">
      <button class="action-button" id="optimizeBtn">üöÄ Otimizar Sistema</button>
      <button class="action-button" id="refreshBtn">üîÑ Atualizar Dados</button>
      <button class="action-button" id="resetBtn">‚öôÔ∏è Restaurar Padr√£o</button>
    </div>
    
    <div class="info-panel">
      <h4>üí° Dicas de Economia</h4>
      <p>‚Ä¢ O modo "Manter Acordado" √© √∫til durante apresenta√ß√µes ou downloads</p>
      <p>‚Ä¢ O modo "Economia de Energia" reduz a frequ√™ncia de atualiza√ß√£o</p>
      <p>‚Ä¢ Use "Otimizar Sistema" para liberar mem√≥ria n√£o utilizada</p>
    </div>
  </div>

  <!-- SCRIPT DA JANELA DE ENERGIA -->
  <script>
    // VARI√ÅVEIS GLOBAIS
    let powerSaveBlockerActive = false;
    let lowPowerModeActive = false;
    let updateInterval;

    // ELEMENTOS DOM
    const powerSaveToggle = document.getElementById('powerSaveToggle');
    const powerSaveStatus = document.getElementById('powerSaveStatus');
    const lowPowerToggle = document.getElementById('lowPowerToggle');
    const lowPowerStatus = document.getElementById('lowPowerStatus');
    const optimizeBtn = document.getElementById('optimizeBtn');
    const refreshBtn = document.getElementById('refreshBtn');
    const resetBtn = document.getElementById('resetBtn');

    // ELEMENTOS DE MONITORAMENTO
    const cpuValue = document.getElementById('cpuValue');
    const cpuBar = document.getElementById('cpuBar');
    const memoryValue = document.getElementById('memoryValue');
    const memoryBar = document.getElementById('memoryBar');
    const tempValue = document.getElementById('tempValue');
    const tempBar = document.getElementById('tempBar');
    const powerValue = document.getElementById('powerValue');
    const powerBar = document.getElementById('powerBar');
    const batteryValue = document.getElementById('batteryValue');
    const batteryBar = document.getElementById('batteryBar');

    // INICIALIZA√á√ÉO
    document.addEventListener('DOMContentLoaded', () => {
      initializePowerManagement();
      startResourceMonitoring();
    });

    // INICIALIZAR GERENCIAMENTO DE ENERGIA
    function initializePowerManagement() {
      // Event listeners para toggles
      powerSaveToggle.addEventListener('click', togglePowerSaveBlocker);
      lowPowerToggle.addEventListener('click', toggleLowPowerMode);
      
      // Event listeners para bot√µes
      optimizeBtn.addEventListener('click', optimizeSystem);
      refreshBtn.addEventListener('click', refreshResourceData);
      resetBtn.addEventListener('click', resetToDefaults);
      
      // Solicitar estado inicial ser√° recebido via onPowerStateUpdate
    }

    // TOGGLE POWER SAVE BLOCKER
    async function togglePowerSaveBlocker() {
      if (window.electronAPI) {
        powerSaveBlockerActive = await window.electronAPI.togglePowerSaveBlocker();
        updatePowerSaveUI();
        
        // üîî Notifica√ß√£o de energia
        if (window.notifications) {
          if (powerSaveBlockerActive) {
            window.notifications.energy(
              'PowerSave Blocker Ativado',
              'Sistema mantido acordado para melhor performance',
              { duration: 3000 }
            );
          } else {
            window.notifications.energy(
              'PowerSave Blocker Desativado',
              'Sistema pode entrar em modo de economia de energia',
              { duration: 3000 }
            );
          }
        }
      }
    }

    // TOGGLE LOW POWER MODE
    async function toggleLowPowerMode() {
      if (window.electronAPI) {
        lowPowerModeActive = await window.electronAPI.toggleLowPowerMode();
        updateLowPowerUI();
        
        // Ajustar frequ√™ncia de atualiza√ß√£o
        if (lowPowerModeActive) {
          clearInterval(updateInterval);
          updateInterval = setInterval(updateResourceData, 5000); // 5 segundos
        } else {
          clearInterval(updateInterval);
          updateInterval = setInterval(updateResourceData, 1000); // 1 segundo
        }
        
        // üîî Notifica√ß√£o de modo economia
        if (window.notifications) {
          if (lowPowerModeActive) {
            window.notifications.energy(
              'Modo Economia Ativado',
              'Reduzindo uso de recursos para economizar energia',
              { duration: 3000 }
            );
          } else {
            window.notifications.energy(
              'Modo Economia Desativado',
              'Performance total restaurada',
              { duration: 3000 }
            );
          }
        }
      }
    }

    // ATUALIZAR UI DO POWER SAVE BLOCKER
    function updatePowerSaveUI() {
      if (powerSaveBlockerActive) {
        powerSaveToggle.classList.add('active');
        powerSaveStatus.classList.remove('status-inactive');
        powerSaveStatus.classList.add('status-active');
      } else {
        powerSaveToggle.classList.remove('active');
        powerSaveStatus.classList.remove('status-active');
        powerSaveStatus.classList.add('status-inactive');
      }
    }

    // ATUALIZAR UI DO LOW POWER MODE
    function updateLowPowerUI() {
      if (lowPowerModeActive) {
        lowPowerToggle.classList.add('active');
        lowPowerStatus.classList.remove('status-inactive');
        lowPowerStatus.classList.add('status-active');
      } else {
        lowPowerToggle.classList.remove('active');
        lowPowerStatus.classList.remove('status-active');
        lowPowerStatus.classList.add('status-inactive');
      }
    }

    // INICIAR MONITORAMENTO DE RECURSOS
    function startResourceMonitoring() {
      updateResourceData();
      updateInterval = setInterval(updateResourceData, 1000);
    }

    // ATUALIZAR DADOS DE RECURSOS
    async function updateResourceData() {
      if (window.electronAPI) {
        try {
          const systemInfo = await window.electronAPI.getSystemInfo();
          updateResourceDisplay(systemInfo);
        } catch (error) {
          console.error('Erro ao obter informa√ß√µes do sistema:', error);
        }
      } else {
        // Dados simulados para teste
        updateResourceDisplay({
          cpu: { cores: 4, speed: 2400 },
          memory: { percentage: Math.random() * 100, used: 8, total: 16 },
          temperature: 45 + Math.random() * 30,
          power: 50 + Math.random() * 100
        });
      }
    }

    // ATUALIZAR DISPLAY DOS RECURSOS
    function updateResourceDisplay(data) {
      // CPU - usando n√∫mero de cores como indicador
      const cpuUsage = Math.min((data.cpu.cores / 8) * 100, 100); // Simular uso baseado em cores
      cpuValue.textContent = `${data.cpu.cores} cores @ ${data.cpu.speed}MHz`;
      cpuBar.style.width = `${cpuUsage}%`;
      
      // Mem√≥ria
      memoryValue.textContent = `${data.memory.used}GB / ${data.memory.total}GB (${data.memory.percentage}%)`;
      memoryBar.style.width = `${data.memory.percentage}%`;
      
      // Temperatura (simulada baseada no uso de mem√≥ria)
      const temperature = 35 + (data.memory.percentage * 0.3);
      tempValue.textContent = `${Math.round(temperature)}¬∞C`;
      tempBar.style.width = `${Math.min(temperature / 100 * 100, 100)}%`;
      
      // Energia (simulada baseada no uso geral)
      const power = 30 + (data.memory.percentage * 1.5);
      powerValue.textContent = `${Math.round(power)}W`;
      powerBar.style.width = `${Math.min(power / 200 * 100, 100)}%`;
      
      // Bateria
      updateBatteryDisplay();
    }

    // ATUALIZAR DISPLAY DA BATERIA
    async function updateBatteryDisplay() {
      try {
        if ('getBattery' in navigator) {
          const battery = await navigator.getBattery();
          const batteryLevel = Math.round(battery.level * 100);
          const isCharging = battery.charging;
          
          // Determinar √≠cone baseado no status
          let icon = 'üîã'; // Bateria padr√£o
          if (isCharging) {
            icon = 'üîå'; // Carregando
          } else if (batteryLevel <= 20) {
            icon = 'ü™´'; // Bateria baixa
          } else if (batteryLevel >= 80) {
            icon = 'üîã'; // Bateria cheia
          }
          
          // Atualizar texto
          const status = isCharging ? 'Carregando' : 'Na bateria';
          batteryValue.textContent = `${batteryLevel}% ${icon}`;
          
          // Atualizar barra de progresso
          batteryBar.style.width = `${batteryLevel}%`;
          
          // Mudar cor da barra baseado no n√≠vel
          if (batteryLevel <= 20) {
            batteryBar.style.background = 'linear-gradient(45deg, #FF6B6B, #FF8E53)'; // Vermelho
          } else if (batteryLevel <= 50) {
            batteryBar.style.background = 'linear-gradient(45deg, #FFD93D, #FF8E53)'; // Amarelo
          } else {
            batteryBar.style.background = 'linear-gradient(45deg, #6BCF7F, #4ECDC4)'; // Verde
          }
          
        } else {
          // Fallback para quando a API de bateria n√£o est√° dispon√≠vel
          batteryValue.textContent = 'N/A üñ•Ô∏è';
          batteryBar.style.width = '0%';
        }
      } catch (error) {
        console.log('API de bateria n√£o dispon√≠vel:', error);
        batteryValue.textContent = 'N/A üñ•Ô∏è';
        batteryBar.style.width = '0%';
      }
    }

    // OTIMIZAR SISTEMA
    async function optimizeSystem() {
      optimizeBtn.textContent = '‚è≥ Otimizando...';
      optimizeBtn.disabled = true;
      
      // üîî Notifica√ß√£o de in√≠cio da otimiza√ß√£o
      if (window.notifications) {
        window.notifications.info(
          'Otimiza√ß√£o Iniciada',
          'Analisando e otimizando recursos do sistema...',
          { duration: 2000 }
        );
      }
      
      if (window.electronAPI) {
        try {
          const result = await window.electronAPI.optimizeResources();
          if (result.success) {
            console.log('Otimiza√ß√£o conclu√≠da:', result.message);
            
            // üîî Notifica√ß√£o de sucesso
            if (window.notifications) {
              window.notifications.success(
                'Sistema Otimizado',
                'Recursos otimizados com sucesso! Performance melhorada.',
                { duration: 4000 }
              );
            }
          } else {
            console.error('Erro na otimiza√ß√£o:', result.message);
            
            // üîî Notifica√ß√£o de erro
            if (window.notifications) {
              window.notifications.warning(
                'Otimiza√ß√£o Parcial',
                'Alguns recursos n√£o puderam ser otimizados.',
                { duration: 4000 }
              );
            }
          }
        } catch (error) {
          console.error('Erro ao otimizar:', error);
          
          // üîî Notifica√ß√£o de erro cr√≠tico
          if (window.notifications) {
            window.notifications.error(
              'Erro na Otimiza√ß√£o',
              'Falha ao otimizar recursos do sistema.',
              { duration: 5000 }
            );
          }
        }
      }
      
      setTimeout(() => {
        optimizeBtn.textContent = 'üöÄ Otimizar Sistema';
        optimizeBtn.disabled = false;
        updateResourceData(); // Atualizar dados ap√≥s otimiza√ß√£o
      }, 2000);
    }

    // ATUALIZAR DADOS
    function refreshResourceData() {
      refreshBtn.textContent = '‚è≥ Atualizando...';
      refreshBtn.disabled = true;
      
      updateResourceData();
      
      setTimeout(() => {
        refreshBtn.textContent = 'üîÑ Atualizar Dados';
        refreshBtn.disabled = false;
      }, 1000);
    }

    // RESTAURAR PADR√ïES
    async function resetToDefaults() {
      if (window.electronAPI) {
        // Desativar powerSaveBlocker se estiver ativo
        if (powerSaveBlockerActive) {
          await window.electronAPI.togglePowerSaveBlocker();
        }
        
        // Desativar modo de baixo consumo se estiver ativo
        if (lowPowerModeActive) {
          await window.electronAPI.toggleLowPowerMode();
        }
      }
      
      // Restaurar intervalo normal
      clearInterval(updateInterval);
      updateInterval = setInterval(updateResourceData, 1000);
      
      // üîî Notifica√ß√£o de restaura√ß√£o
      if (window.notifications) {
        window.notifications.info(
          'Configura√ß√µes Restauradas',
          'Todas as configura√ß√µes de energia foram restauradas aos padr√µes.',
          { duration: 3000 }
        );
      }
    }

    // LISTENERS PARA COMUNICA√á√ÉO COM O PROCESSO PRINCIPAL
    if (window.electronAPI) {
      // Receber estado inicial
      window.electronAPI.onPowerStateUpdate((state) => {
        powerSaveBlockerActive = state.powerSaveBlocker;
        lowPowerModeActive = state.lowPowerMode;
        updatePowerSaveUI();
        updateLowPowerUI();
      });
    }

    // CLEANUP AO FECHAR JANELA
    window.addEventListener('beforeunload', () => {
      if (updateInterval) {
        clearInterval(updateInterval);
      }
    });
  </script>

  <!-- Sistema de notifica√ß√µes elegante -->
  <script src="notifications.js"></script>
</body>
</html>